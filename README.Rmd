---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "doc/figures/readme-",
  out.width = "100%"
)

library(cvasi)
```

# cvasi: Calibration, Validation, and Simulation of TKTD models in R

<!-- badges: start -->
<!--[![CRAN status](https://www.r-pkg.org/badges/version/cvasi)](https://cran.r-project.org/package=cvasi)-->
<!--[![R-CMD-check](https://github.com/cvasi-tktd/cvasi/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/cvasi-tktd/cvasi/actions/workflows/R-CMD-check.yaml)-->
<!--[![Codecov test coverage](https://codecov.io/gh/xy/cvasi/branch/main/graph/badge.svg)](https://app.codecov.io/gh/xy/cvasi?branch=main)-->
<!-- badges: end -->

The `cvasi` package aims to ease the use of ecotox effect models by providing an
intuitive workflow. Model inputs and parameters are encapsulated in scenario
objects which can be piped to other functions. Operations can be chained using
the `tidyr` syntax. The most time-consuming processes can be run in parallel if
requested.

The package provides facilities to

* simulate effect models such as *GUTS-RED*, *DEB*, *Lemna*, *Myriophyllum*, and *Algae*
* calculate effect endpoints
* derive effect profiles (*EPx* values)
* import exposure time-series from *FOCUS TOXSWA*
* import fitted parameters from *morse*
* and more

A graphical user interface implemented in [Shiny](https://www.rstudio.com/products/shiny/)
is also available, see the *[cvasi.ui](https://github.com/cvasi-tktd/cvasi.ui/)*
package. Please have a look at the [Changelog](NEWS.md)
for an overview of user-facing updates and changes.


## Installation

<!-- 1. Install from CRAN -->
<!-- ```{r eval=FALSE} -->
<!-- install.packages("cvasi", dependencies=TRUE) -->
<!-- ``` -->

Install latest version from GitHub:

```{r eval=FALSE}
install.packages("remotes", dependencies=TRUE)
remotes::install_github("cvasi-tktd/cvasi", dependencies=TRUE)
```

## Documentation

The package contains the following vignettes

* [User Manual](doc/cvasi-1-manual.md)
* [Modeling Howto](doc/cvasi-2-howto.md)

They can also be accessed locally by executing an *R* statement such as:
```{r, eval=FALSE}
vignette("manual", package="cvasi")
```


## Usage

Basic usage:
```{r,message=FALSE}
library(cvasi)

# create and parameterize a GUTS-RED-IT scenario
GUTS_RED_IT() %>%
  set_param(c(kd=0.0005, hb=0, alpha=0.4, beta=1.5)) %>%
  set_exposure(data.frame(time=c(0, 100, 101, 200, 201, 400),
                          conc=c(0, 0, 0.1, 0.1, 0, 0))) -> scenario

# simulate scenario
scenario %>%
  simulate(times=1:400) %>%
  tail()
```

Calculation of effects:
```{r out.width="50%",warning=FALSE}
# calculate effect level
scenario %>% effect()

# create a dose-response curve
scenario %>% dose_response() -> drc
head(drc)

# plot the dose-response curve
library(ggplot2)
ggplot(drc) + geom_point(aes(mf,effect)) + scale_x_log10()
# derive EPx values
scenario %>% epx()
```

Multiple scenarios can be processed in parallel without modifications to the workflow:
```{r eval=FALSE}
# enable parallel processing
future::plan(future::multisession)

# derive EPx for a list of 100 scenarios in parallel
rep(c(scenario), 100) %>% epx()

# disable parallel processing
future::plan(future::sequential)
```

## License

The package and its source code is free and open-source software available under
the [GPL-3.0 license](https://github.com/cvasi-tktd/cvasi/blob/main/LICENSE.md).

## Issues

If you find any issues or bugs within the package, please create a
[new issue](https://github.com/cvasi-tktd/cvasi/issues) on GitHub.

## Contributing

Contributions to the project are welcome! Please have a look at the
[Contribution Guidelines](https://github.com/cvasi-tktd/cvasi/blob/main/CONTRIBUTING.md) before submitting a Pull Request.


## Acknowledgements

Financial support for creation and release of this software project was provided
by Bayer Crop Science. This R package started as an internal project at Bayer
Crop Science and the project owners would like to thank the people who have
contributed (in no particular order):

Nils Kehrein, Johannes Witt, Andr√© Gergs, Thomas Preuss, Julian Heinrich,
Zhenglei Gao, Tjalling Jager, Dirk Nickisch, Torben Wittwer, and Peter Vermeiren.

